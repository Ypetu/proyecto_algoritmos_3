<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <mat-card class="payment-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>credit_card</mat-icon>
            Información de Pago
          </mat-card-title>
          <mat-card-subtitle>Total a pagar: <span class="total-amount">${{ cartTotal | number:'1.2-2' }}</span></mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="paymentForm" class="payment-form">
            
            <!-- Número de Tarjeta -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Número de Tarjeta</mat-label>
              <input 
                matInput 
                formControlName="cardNumber"
                (input)="formatCardNumber($event)"
                placeholder="1234 5678 9012 3456"
                maxlength="19">
              <mat-icon matSuffix>credit_card</mat-icon>
              <mat-error *ngIf="paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched">
                {{ getFieldError('cardNumber') }}
              </mat-error>
            </mat-form-field>

            <div class="row">
              <!-- Fecha de Vencimiento -->
              <div class="col-6">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Vencimiento</mat-label>
                  <input 
                    matInput 
                    formControlName="expiryDate"
                    (input)="formatExpiryDate($event)"
                    placeholder="MM/YY"
                    maxlength="5">
                  <mat-error *ngIf="paymentForm.get('expiryDate')?.invalid && paymentForm.get('expiryDate')?.touched">
                    {{ getFieldError('expiryDate') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- CVV -->
              <div class="col-6">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>CVV</mat-label>
                  <input 
                    matInput 
                    formControlName="cvv"
                    type="password"
                    placeholder="123"
                    maxlength="4">
                  <mat-error *ngIf="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched">
                    {{ getFieldError('cvv') }}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <!-- Nombre del Titular -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre del Titular</mat-label>
              <input 
                matInput 
                formControlName="cardholderName"
                placeholder="Juan Pérez">
              <mat-error *ngIf="paymentForm.get('cardholderName')?.invalid && paymentForm.get('cardholderName')?.touched">
                {{ getFieldError('cardholderName') }}
              </mat-error>
            </mat-form-field>

          </form>
        </mat-card-content>

        <mat-card-actions align="end">
          <button mat-button (click)="goBack()" [disabled]="isProcessing" class="back-button">
            <mat-icon>arrow_back</mat-icon>
            Volver
          </button>
          
          <button mat-raised-button 
                  color="primary" 
                  [disabled]="paymentForm.invalid || isProcessing"
                  (click)="confirmPurchase()"
                  [class.processing]="isProcessing">
            <mat-icon *ngIf="isProcessing">hourglass_empty</mat-icon>
            <mat-icon *ngIf="!isProcessing">shopping_cart</mat-icon>
            {{ isProcessing ? 'Procesando...' : 'Confirmar Compra' }}
          </button>
        </mat-card-actions>

      </mat-card>
    </div>
  </div>
</div>
